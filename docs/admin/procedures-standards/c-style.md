# C Style Guide

This style guide is taken mostly from [Harvard's CS50 style guide](https://cs50.readthedocs.io/style/c/) and the [Linux kernel coding style](https://www.kernel.org/doc/html/v4.10/process/coding-style.html) guide.

This style guide is not nearly as exhaustive as some you will come across in industry (see [Google's C++ style guide](https://google.github.io/styleguide/cppguide.html), for instance).

> [!IMPORTANT]
> You will be graded based upon your adherence to this style guide.

## Naming Conventions
### Filenames
File names should be `snake_case` or `kebab-case`

### Constants
Constants should be `ALL_CAPS`.

### Variables
Variables should be `snake_case`, as this is the most common convention in C.

### Functions
Function names should be `snake_case`.

## Comments

Comments are generally good, but bad comments can be worse than no comment at all. In general, comments should not explain how your code works. If the code itself is not clear, you should rewrite the code. Comments should explain the *intention* of the code, e.g., "what" and "why".

[This stackoverflow post has some thoughts on writing good comments](https://stackoverflow.blog/2021/12/23/best-practices-for-writing-code-comments/).

We'll use [Doxygen](https://doxygen.nl/index.html) comments to document our files, functions, structs, etc. There are no special formatting guidelines for comments that aren't intended to be part of autogenerated documentation. 

This guide will use Javadoc style doxygen comment blocks:
```c
/**
 * This is a Javadoc style comment block.
 *
 * The comment block starts with two *'s. The *'s on intermediate lines are
 * aligned with the first *. The intermediate *'s are optional, but this style
 * is my personal preference. The ending * is also aligned with the first *,
 * which is indented by one space from the current indentation level.
 */
 ```


### File header documentation
The file header should include a `@file` command, a brief description, and optionally an extended description.
```c
/**
 * @file
 * @brief A brief description of the module's purpose.
 *
 * An optional extended description of the module.
 */
```

### Function documentation

```c
/**
 * Brief description of function.
 *
 * A longer description, with more discussion of the function 
 * that might be useful to those using or modifying it. 
 *
 * @param: param1 Describe the first argument.
 * @param: param2 Describe the second argument.
 *
 * @return: If the function has a return value, describe it here.
 */
 uint16_t some_function(int param1, int8_t param2)
```


### Struct documentation

Struct members should be documented above the members. Note that the comments still use two *'s.

```c
/**
 * A brief description of the struct
 *
 * An optional extended description
 */
struct foo
{
    /** Description of bar field */
    uint8_t bar

    /** Description of baz field */
    bool baz
}
```


## Formatting

### Indentation
- Use 4 spaces for indentations. 
- Use spaces instead of hard-tabs. Set up your editor to use soft-tabs.

Here's some nicely indented code:

```c
// Print command-line arguments one per line
printf("\n");
for (int i = 0; i < argc; i++)
{
    for (int j = 0, n = strlen(argv[i]); j < n; j++)
    {
        printf("%c\n", argv[i][j]);
    }
    printf("\n");
}
```

### Line Length

Lines should be less than 120 characters long. This is a soft limit, rather than an absolute hard limit.

If a line is longer than 120 characters, that could indicate some design problems, e.g.,
- your code is nested too deep
- you are using excessively long variable names (descriptive names are good, but they can be too long...)

### Bracket placement
Brackets should be placed on their own line, for example: 
```c
if (x > 0)
{
    printf("x is positive\n");
}
else if (x < 0)
{
    printf("x is negative\n");
}
else
{
    printf("x is zero\n");
}
```

This makes the scope / nesting-level very easy to see.


### Conditional statements 

Conditions should be styled as follows:

```c
if (x > 0)
{
    printf("x is positive\n");
}
else if (x < 0)
{
    printf("x is negative\n");
}
else
{
    printf("x is zero\n");
}
```

Notice how:

- the curly braces line up nicely, each on its own line, making perfectly clear what's inside the branch;
- there's a single space after each `if`;
- each call to `printf` is indented with 4 spaces;
- there are single spaces around the `>` and around the `<`; and
- there isn't any space immediately after each `(` or immediately before each `)`.

#### One-line if statements

Brackets should always be used for if statements, even if the body only has one line.

Do this
```c
if (x > 0)
{
    printf("x is positive\n");
}
```

not this
```c
if (x > 0)
    printf("x is positive\n");
```

The reason is that if you need to add more lines to the if statement's body, you will then need to add braces. You might forget to add braces, which will result in a bug because every statement after the first will not be part of if statement's body.

### Switches

Declare a `switch` as follows:

```c
switch (n)
{
    case -1:
        printf("n is -1\n");
        break;

    case 1:
        printf("n is 1\n");
        break;

    default:
        printf("n is neither -1 nor 1\n");
        break;
}
```

Notice how:

- each curly brace is on its own line;
- there's a single space after `switch`;
- there isn't any space immediately after each `(` or immediately before each `)`;
- the switch's cases are indented with 4 spaces;
- the cases' bodies are indented further with 4 spaces; and
- each `case` (including `default`) ends with a `break`.

### Functions

Curly braces should be on their own line.

In accordance with [C99](http://en.wikipedia.org/wiki/C99), be sure to declare `main` with:

```c
int main(void)
{

}
```

or with:

```c
int main(int argc, char *argv[])
{

}
```

or even with:

```c
int main(int argc, char **argv)
{

}
```

Do not declare `main` with:

```c
int main()
{

}
```

or with:

```c
void main()
{

}
```

or with:

```c
main()
{

}
```


### Loops

#### for

```c
for (int i = 0; i < LIMIT; i++)
{
    for (int j = 0; j < LIMIT; j++)
    {
        for (int k = 0; k < LIMIT; k++)
        {
            // Do something
        }
    }
}
```

#### while

Declare `while` loops as follows:

```c
while (condition)
{
    // Do something
}
```

Notice how:

- each curly brace is on its own line;
- there's a single space after `while`;
- there isn't any space immediately after the `(` or immediately before the `)`; and
- the loop's body (a comment in this case) is indented with 4 spaces.

#### do ... while

Declare `do ... while` loops as follows:

```c
do
{
    // Do something
}
while (condition);
```

Notice how:

- each curly brace is on its own line;
- there's a single space after `while`;
- there isn't any space immediately after the `(` or immediately before the `)`; and
- the loop's body (a comment in this case) is indented with 4 spaces.

### Pointers

When declaring a pointer, write the `*` next to the variable, as in:

```c
int *p;
```

Don't write it next to the type, as in:

```c
int* p;
```

### Autoformatting code

CCS has a clangd extension installed by default that can format code. A `.clang-format` file is included in your repositories that is configured to follow the code style in this document.

You may format your code in CSS by running "Format document" or "Format selection" (ctrl+shift+p, then type format).

> [!NOTE]
> You must first download the clangd server (ctrl+shift+p -> clangd: Download language server)

## Headers
All modules should have an associated header file that has a `.h` file extension. `main.c` should be not have a `main.h` header.

### Include guards
Header files should have [include guards](https://en.wikipedia.org/wiki/Include_guard) to prevent multiple inclusion.

`module_name.h`:
```c
#ifdef MODULE_NAME_H
#define MODULE_NAME_H

// ... file content

#endif // MODULE_NAME_H
```

## Linting

`clang-tidy` is included in the clangd extension in CCS. `clang-tidy` will provide suggestions and warnings about common programming errors and bug-prone bug.

There is a `.clang-tidy` file in your repositories that has some checks configured.

Suggestions will automatically show up in CCS in the "problems" tab and as red squiggles in the text editor.